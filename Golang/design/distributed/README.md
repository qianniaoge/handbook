# 分布式系统

## CAP原理

CAP定理又称CAP原则，指的是在一个分布式系统中：Consistency（一致性）、 Availability（可用性）、Partition tolerance（分区容错性），最多只能同时三个特性中的两个，三者不可兼得，最多满足其中的两个特性

AP(高可用但是在网络分区时不一致)系统和系统和CP(提供一致性但是网络分区时不可用)系统哪个更合适

## 注册发现

分布式系统服务注册中心本质上是为了解耦服务提供者和服务消费者。对于任何一个系统，都可能存在众多服务提供者和消费者，为了支持弹性扩缩容特性，一个分布式微服务的数量和分布情况往往是动态变化的，且无法预先确定的。因此，原本在单体应用阶段常用的静态LoadBalance机制就不再适用了，需要引入额外的组件来管理服务的注册与发现，而这个组件就是服务注册中心。

对于服务发现来说，情况就不太一样了，针对同一个服务，即使注册中心的不同节点保存的服务提供者信息不尽相同，也并不会造成灾难性的后果。因为对于服务消费者来说，能消费才是最重要的，消费者虽然拿到可能不正确的服务实例信息后尝试消费一下，也要胜过因为无法获取实例信息而不去消费，导致系统异常要好。从这一点上来说，分布式服务注册中心AP模式要更优于CP模式。这也是为什么越来越多的人抛弃Zookeeper的原因所在。

但是如果某个服务已经下线了，而注册中心由于网络分区导致数据不一致，而这时有个消费者刚好拿到了下线了的机子，是有可能导致服务执行失败的，所以具体使用AP还是CP模式也没有定论

``` txt
Feature	Consul	zookeeper	etcd	euerka
服务健康检查	服务状态，内存，硬盘等	(弱)长连接，keepalive	连接心跳	可配支持
多数据中心	支持	—	—	—
kv存储服务	支持	支持	支持	—
一致性	raft	paxos	raft	—
cap	ca	cp	cp	ap
使用接口(多语言能力)	支持http和dns	客户端	http/grpc	http（sidecar）
watch支持	全量/支持long polling	支持	支持 long polling	支持 long polling/大部分增量
自身监控	metrics	—	metrics	metrics
安全	acl /https	acl	https支持（弱）	—
spring cloud集成	已支持	已支持	已支持	已支持
```

使用etcd实现服务注册与发现

`go get go.etcd.io/etcd/client/v3`



3、负载均衡
4、配置中心
5、分布式锁
6、重试幂等
7、雪崩: 熔断、限流、降级、扩容
8、可观测性
9、故障
